/*=======================================================================*\
|| ###################################################################### ||
|| # vBulletin 5.2.3
|| # ------------------------------------------------------------------ # ||
|| # Copyright 2000-2016 vBulletin Solutions Inc. All Rights Reserved.  # ||
|| # This file may not be redistributed in whole or significant part.   # ||
|| # ----------------- VBULLETIN IS NOT FREE SOFTWARE ----------------- # ||
|| # http://www.vbulletin.com | http://www.vbulletin.com/license.html   # ||
|| ###################################################################### ||
\*========================================================================*/
window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["error","error_trying_to_change_user_status","error_x","follow","following","following_pending","following_remove","invalid_server_response_please_try_again","profile_guser","edit_avatar","invalid_data","no_permission","invalid_url","unable_to_upload_profile_photo","profile_media","album","album_saved","please_enter_message_x_chars","please_enter_title_x_chars","unable_to_contact_server_please_try_again"]);window.vBulletin.options=window.vBulletin.options||{};window.vBulletin.options.precache=window.vBulletin.options.precache||[];window.vBulletin.options.precache=$.merge(window.vBulletin.options.precache,["postminchars","statusMaxChars"]);var albumPhotoCount=0;(function(A){var B=[".profile-sidebar-widget"];if(!vBulletin.pageHasSelectors(B)){return false}if(vBulletin.isAlreadyLoaded("profile")){}A(document).ready(function(){var C=A(".profile-widget"),H=A("#profileTabs");if(H.length>0){var F=H.find(".ui-tabs-nav > li"),N=F.filter(".ui-tabs-active"),M=N.index(),X,D,I=A(".subscribed-tab",H),Q=A(".conversation-list",I),L=A(".activities-tab",H),G=A(".conversation-list",L),P,R,S={},K=F.parent().data("allow-history")=="1",E=new vBulletin.history.instance(K),J=C.find(".js-module-top-anchor").attr("id");if(M==-1){M=0;N=F.first()}X=N.find("> a").attr("href");F.removeClass("ui-state-disabled");function V(b,a,d,Z){if(E.isEnabled()){var c=E.getState();if(Z||!c||A.isEmptyObject(c.data)){var Y={from:b,tab:a,page:typeof d=="undefined"?undefined:d};E.setDefaultState(Y,document.title,location.href)}}}var U=function(a,Z,Y){Z.setOption("context",a);if(typeof Z.lastFilters!="undefined"&&A(".conversation-empty:not(.h-hide)",Y).length>0){delete Z.lastFilters}};var O=function(Y){vBulletin.truncatePostContent(Y);vBulletin.conversation.processPostContent(Y)};var W=function(d,Y,c,b,Z,e){var a=new vBulletin.conversation.filter({context:d,allowHistory:b,tabParamAsQueryString:false,onContentLoad:function(){O(Y);if(Z){Z()}}});if(c){O(Y);if(e){e()}a.lastFilters={filters:a.getSelectedFilters(A(".toolbar-filter-overlay",d))}}return{filter:a}};var T=function(Z,Y,d){var c=Y.id,k=A(Y),b=(X==d);if(typeof S[c]=="undefined"){S[c]=A(".conversation-toolbar-wrapper",Y).data("allow-history")=="1"}if(d=="#activities-tab"){if(!D){var l=function(){if(vBulletin.upload){vBulletin.upload.initializePhotoUpload(L)}};var e=W(L,G,b,S[c],l,l);D=e.filter}else{U(L,D,Y)}D.applyFilters(false,true)}else{if(d=="#subscribed-tab"){if(!P){var g=W(I,Q,b,S[c],null,null);P=g.filter}else{U(I,P,Y)}P.applyFilters(false,true)}else{if(d=="#about-tab"){if(b){V("tabs","about");return }var i=A(".js-profile-about-container",Y);if(A(".section",i).length==0){A.post(vBulletin.getAjaxBaseurl()+"/profile/fetchAbout",{userid:i.data("user-id")},function(m){i.html(m)},"html")}}else{if(d=="#media-tab"){var h=Number(A("#mediaCurrentPage").val());if(b){V("media_filter","media",h,true);vBulletin.media.setHistoryStateChange();k.data("media-statechange-set",true);return }var a=A(".js-profile-media-container",Y);if(A(".item-album",a).length==0){var f=0;if(typeof (vBulletin.contentEntryBox)=="undefined"){f=1}A.post(vBulletin.getAjaxBaseurl()+"/profile/fetchMedia",{userid:a.data("user-id"),perpage:a.data("perpage"),allowHistory:1,includeJs:f,isAjaxTemplateRender:true},function(m){a.html(m);if(b){var n=Number(A("#mediaCurrentPage").val());V("media_filter","media",n,true)}vBulletin.media.setHistoryStateChange(true);k.data("media-statechange-set",true);if(typeof (vBulletin.contentEntryBox)!="undefined"){vBulletin.contentEntryBox.init()}},"json")}else{if(!k.data("media-statechange-set")){V("media_filter","media",h,true);vBulletin.media.setHistoryStateChange();k.data("media-statechange-set",true)}}}else{if(d=="#infractions-tab"){var h=Number(A(".pagenav-form .js-pagenum",Y).val())||1;if(b){if(A(".pagenav-form",Y).length&&!k.data("pagination-instance")){var j=new vBulletin.pagination({context:k,tabParamAsQueryString:false,allowHistory:k.find(".conversation-toolbar-wrapper").data("allow-history")==1,onPageChanged:function(m,n){vBulletin.infraction.loadUserInfractions({container:k,userid:k.data("userid"),pageNumber:m,replaceState:true})}});k.data("pagination-instance",true)}V("infraction_filter","infractions",h,true);vBulletin.infraction.setHistoryStateChange();k.data("infraction-statechange-set",true);return }if(A(".infraction-list",Y).length==0){V("infraction_filter","infractions",h,true);vBulletin.infraction.loadUserInfractions({container:k,userid:k.data("userid"),pageNumber:h,callback:function(){vBulletin.infraction.setHistoryStateChange();k.data("infraction-statechange-set",true)}})}else{if(!k.data("infraction-statechange-set")){V("infraction_filter","infractions",h,true);vBulletin.infraction.setHistoryStateChange();k.data("infraction-statechange-set",true)}}}}}}}};vBulletin.tabify.call(H,{tabHistory:E,getTabIndexByHash:function(Y){Y=Y||X;return F.filter('li:has(a[href*="'+Y+'"])').first().index()},allowHistory:K,tabParamAsQueryString:false,hash:J,tabOptions:{active:M,beforeActivate:function(Y,Z){if(D){D.hideFilterOverlay()}if(P){P.hideFilterOverlay()}},create:function(Y,Z){T(Z.tab,Z.panel,Z.panel.selector)},activate:function(Y,Z){T(Z.newTab,Z.newPanel,Z.newPanel.selector)}}});A(".customize-theme").off("click").on("click",function(Z){var Y=A(".profile_custom_edit");if(Y.is(":hidden")){if(A(".profileNavTabs",Y).length>0){Y.removeClass("h-hide");vBulletin.animateScrollTop(Y.offset().top,{duration:"slow"})}else{A.post(vBulletin.getAjaxBaseurl()+"/ajax/render/profile_custom_edit",{userid:Y.data("page-userid")},function(a){Y.html(a);Y.prependTo("#content").removeClass("h-hide");vBulletin.animateScrollTop(Y.offset().top,{duration:"slow"})},"json").error(function(){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error"})}).complete(function(){})}}else{vBulletin.animateScrollTop(Y.offset().top,{duration:"slow"})}})}else{A(".customize-theme").addClass("h-hide-imp")}A(".profileDetailTabs").tabs();A(".toggle_customizations").off("click").on("click",function(a){var Y=A(this),Z;if(Y.attr("data-action")=="show"){Z=1}else{Z=0}A.ajax({url:vBulletin.getAjaxBaseurl()+"/profile/toggle-profile-customizations",data:{showusercss:Z},type:"POST",dataType:"json",complete:function(){A("body").css("cursor","auto")},success:function(b){window.location.reload()},error:function(d,c,b){console.log("/profile/toggle-profile-customizations error: "+b);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error"),iconType:"error",onAfterClose:function(){window.location.reload()}})}})});if(H.length>0){C.off("click",".list-item-poll .view-more-ctrl").on("click",".list-item-poll .view-more-ctrl",function(Z){var Y=A(this).closest("form.poll");var a=Y.find("ul.poll");A(this).addClass("h-hide");a.css("max-height","none").find("li.h-hide").slideDown(100,function(){Y.find(".js-button-group").removeClass("h-hide").next(".view-less-ctrl").removeClass("h-hide");vBulletin.animateScrollTop(Y.offset().top,{duration:"fast"})});return false});C.off("click",".list-item-poll .view-less-ctrl").on("click",".list-item-poll .view-less-ctrl",function(Z){var Y=A(this).closest("form.poll");vBulletin.conversation.limitVisiblePollOptionsInAPost(Y,3);Y.find("ul.poll").css("max-height","").find("li.h-hide").slideUp(100);return false});A(document).off("click",".unsubscribe-close").on("click",".unsubscribe-close",function(){var Y=A(this).parents(".unsubscribe-overlay");A(Y).dialog("close").remove()});A(document).off("click",".unsubscribe-delete").on("click",".unsubscribe-delete",function(){vBulletin.subscribe.removeUnsubscribeOptions(this,P)});A(document).off("click",".profileTabs .action_button").on("click",".profileTabs .action_button",function(){if(!A(this).hasClass("subscribepending_button")){var Y=A(this);var a=parseInt(Y.attr("data-userid"));var Z="";if(Y.hasClass("subscribe_button")){Z="add"}else{if(Y.hasClass("unsubscribe_button")){Z="delete"}}if((typeof (a)=="number")&&Z){A.ajax({url:vBulletin.getAjaxBaseurl()+"/profile/follow-button?do="+Z+"&follower="+a+"&type=follow_members",type:"POST",dataType:"json",success:function(c){if(c==1||c==2){if(Z=="add"){var b=(c==1)?"subscribed":"subscribepending";var d=(c==1)?"following":"following_pending";Y.removeClass("subscribe_button").addClass(b+"_button b-button").find(".js-button__text-primary").text(vBulletin.phrase.get(d))}else{if(Z=="delete"){Y.removeClass("subscribed_button unsubscribe_button b-button b-button--special").addClass("subscribe_button b-button b-button--secondary").find(".js-button__text-primary").text(vBulletin.phrase.get("follow"))}}location.reload()}else{if(c.errors){openAlertDialog({title:vBulletin.phrase.get("profile_guser"),message:vBulletin.phrase.get(c.errors[0]),iconType:"error"})}}},error:function(){openAlertDialog({title:vBulletin.phrase.get("profile_guser"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error"})}})}}});A(document).off("mouseover",".profileTabs .action_button.subscribed_button").on("mouseover",".profileTabs .action_button.subscribed_button",function(Y){A(this).html(vBulletin.phrase.get("following_remove")).addClass("b-button").toggleClass("subscribed_button unsubscribe_button b-button--special b-button--secondary")});A(document).off("mouseout",".profileTabs .action_button.unsubscribe_button").on("mouseout",".profileTabs .action_button.unsubscribe_button",function(Y){A(this).html(vBulletin.phrase.get("following")).addClass("b-button").toggleClass("subscribed_button unsubscribe_button b-button--special b-button--secondary")});A(document).off("click",".js-updata-status-btn").on("click",".js-updata-status-btn",function(){var Z=A(this).closest(".section-content").find(".js-user-status-text");var Y=A.trim(Z.val());if(Z.hasClass("placeholder")&&Y==Z.attr("placeholder")){Y=""}var a=window.vBulletin.options.get("statusMaxChars");if(Y.length>a){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("please_enter_user_status_with_at_most_x_characters",a),iconType:"warning"});return false}vBulletin.AJAX({call:"/profile/update-status",data:{userid:pageData.userid,status:Y},title_phrase:"profile_guser",error_phrase:"error_trying_to_change_user_status",success:function(b){A("#userStatus").text('"'+b+'"');Z.val("")},emptyResponse:function(){A("#userStatus").text("");Z.val("")}})});vBulletin.conversation.bindEditFormEventHandlers("all");C.off("click",".js-post-control__ip-address").on("click",".js-post-control__ip-address",vBulletin.conversation.showIp);C.off("click",".js-post-control__vote").on("click",".js-post-control__vote",function(Y){if(A(Y.target).closest(".bubble-flyout").length==1){vBulletin.conversation.showWhoVoted.apply(Y.target,[Y])}else{vBulletin.conversation.votePost.apply(this,[Y])}return false});C.off("click",".js-post-control__edit").on("click",".js-post-control__edit",vBulletin.conversation.editPost);C.off("click",".js-post-control__flag").on("click",".js-post-control__flag",vBulletin.conversation.flagPost);C.off("click",".js-post-control__comment").on("click",".js-post-control__comment",vBulletin.conversation.toggleCommentBox);C.off("click",".js-comment-entry__post").on("click",".js-comment-entry__post",function(Y){vBulletin.conversation.postComment.apply(this,[Y,function(){location.reload()}])});C.off("click",".post-controls .replyCtrl").on("click",".post-controls .replyCtrl",function(){alert("Not implemented yet")})}if(A("body").is(".view-mode")){A("#editProfilePicture").off("click").on("click",editProfilePhoto);A("#btnProfilePhotoSave").off("click").on("click",cropProfilePhoto)}A("#btnProfilePhotoContinue").off("click").on("click",function(){var Z=A("[name=profile-img-option]:checked").val();switch(parseInt(Z)){case 2:var Y=A("#profilePhotoUrl").val();if(!Y){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("upload_invalid_url"),iconType:"error"});break}initIAS();A("#profilePicImgCrop").attr("src",Y);case 1:A("div#cropFrame").removeClass("h-hide");A("#btnProfilePhotoSave").removeClass("h-hide-imp");A("#btnProfilePhotoContinue").addClass("h-hide-imp");A("div#uploadFrame").addClass("h-hide");A("#btnProfilePhotoClose").focus();break;case 4:resetAvatar();break}});A("#btnProfilePhotoClose").off("click").on("click",function(){closeUploader();resetCropValues();A("div#uploadFrame").removeClass("h-hide");A("div#cropFrame").addClass("h-hide");A("#btnProfilePhotoSave").addClass("h-hide-imp");A("#btnProfilePhotoContinue").removeClass("h-hide-imp");A("#editProfilePhotoDlg").dialog("close").find("form").trigger("reset")});A(document).off("click",".gallery-upload-form .files a:not([target^=_blank])").on("click",".gallery-upload-form .files a:not([target^=_blank])",function(Y){Y.preventDefault();A('<iframe style="display:none;"></iframe>').prop("src",this.href).appendTo("body")});A("#editProfilePhotoDlg .frmprofilePhoto").ajaxForm({success:function(Z,c,e,Y){if(Z){if(Z.errors){if(typeof (Z.errors[0])=="undefined"){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get(Z.errors),iconType:"error"})}else{openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get(Z.errors[0][0]),iconType:"error"})}}else{if(Z["0"]){var b=Z["0"].indexOf("?")==-1?"?":"&";var d=A("#profilePicImg").attr("src",pageData.baseurl_core+"/"+Z["0"]+b+"random="+Math.random()).attr("src");A(".avatar-"+pageData.userid).attr("src",d);var a=A("#editProfilePhotoDlg");a.find("form").trigger("reset");a.dialog("close")}}}else{openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("unable_to_upload_profile_photo"),iconType:"error"})}},error:function(Y){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error"})},complete:function(a,Z){var Y=A("#editProfilePhotoDlg");Y.find(".js-upload-progress").addClass("h-hide");Y.find("input,button").prop("disabled",false);Y.find(".custom-upload-button").removeClass("h-disabled")},dataType:"json",beforeSerialize:function(){var Y=A("#editProfilePhotoDlg");var Z=A('[name="profile-img-option"]:checked',Y);if(Z.val()=="2"&&A.trim(A(".profilePhotoUrl",Y).val())!=""){Y.find("button, input").prop("disabled",true);Z.closest(".profile-img-option-container").find(".profile-img-option-field input").prop("disabled",false)}return true},beforeSubmit:function(e,Y,c){var f=A('[name="profile-img-option"]:checked',Y);var d=f.val(),b=true;if(d=="1"){if(A(".fileText",Y).val()==""){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:"Please browse an image to upload.",iconType:"warning",onAfterClose:function(){f.focus()}});b=false}}else{if(d=="2"){if(A.trim(A(".profilePhotoUrl",Y).val())==""){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:"Please specify the image URL from a hosting site.",iconType:"warning",onAfterClose:function(){A(".profilePhotoUrl",Y).focus()}});b=false}}else{if(d=="3"){var a=A(".avatarHolder .defaultAvatarSet.defaultAvatarSelected").data("avatarid");if(!a){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:"Please select a default profile photo.",iconType:"warning",onAfterClose:function(){f.focus()}})}else{setDefaultAvatar(a)}b=false}}}if(b){var Z=A("#editProfilePhotoDlg");Z.find(".js-upload-progress").removeClass("h-hide");Z.find(".custom-upload-button").addClass("h-disabled")}return b}})})})(jQuery);var ias=null;editProfilePhoto=function(D){$(".defaultAvatarSet").removeClass("defaultAvatarSelected");$("#defaultAvatars").html("");var A=$("#editProfilePhotoDlg").dialog({width:734,title:vBulletin.phrase.get("edit_avatar"),autoOpen:false,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,dialogClass:"dialog-container edit-profile-photo-dialog-container dialog-box"}).dialog("open");$(".profile-img-option-container .browse-option").off("click").on("click",function(E){$(".avatarHolder .defaultAvatarSet.defaultAvatarSelected").removeClass("defaultAvatarSelected")});$(".profile-img-option-container .url-option").off("click").on("click",function(E){var F=$(this);$(".avatarHolder .defaultAvatarSet.defaultAvatarSelected").removeClass("defaultAvatarSelected");setTimeout(function(){F.closest(".profile-img-option-container").find(".profilePhotoUrl").trigger("focus.photourl")},10)});$(".profile-img-option-container .default-option").off("click").on("click",function(E){if($("#defaultAvatars .avatarHolder").length==0){var F=$(this);F.closest(".profile-img-option-container").find(".js-upload-progress").removeClass("h-hide");$.ajax({url:vBulletin.getAjaxBaseurl()+"/profile/getdefaultavatars",type:"POST",dataType:"html",success:function(G){if(G){if(G.errors){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get(G.errors[0][0]),iconType:"error"})}else{$("#defaultAvatars").html(G);$(".defaultAvatarSet").off("click").on("click",function(){$(".defaultAvatarSet").removeClass("defaultAvatarSelected");$(this).addClass("defaultAvatarSelected");$(".profile-img-option-container .default-option").trigger("click")})}}else{openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(G){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})},complete:function(){F.closest(".profile-img-option-container").find(".js-upload-progress").addClass("h-hide")}})}});var C=$("#editProfilePicture").data("avatarmaxsize");var B=false;$("#profilePhotoFile").off("click").on("click",function(){$(this).closest(".profile-img-option-container").find(".browse-option").trigger("click")}).fileupload({url:vBulletin.getAjaxBaseurl()+"/profile/upload-profilepicture",dropZone:null,dataType:"json",add:function(I,H){if(!H.crop){B=H;var G="undefined";var F=(typeof window.createObjectURL!==G&&window)||(typeof URL!==G&&URL)||(typeof webkitURL!==G&&webkitURL);var E=F?F.createObjectURL(H.files[0]):$(H.fileInput).val();var J=H.files[0].fileName||H.files[0].name;$(".profile-img-option-container .fileText").val(J);if(!F){B.fileInput.attr("name","profilePhotoFull");B.submit();B.fileInput.attr("name","profilePhotoFile");closeUploader()}else{$("#btnProfilePhotoContinue").trigger("click");initIAS();$("#profilePicImgCrop").attr("src",E)}}else{H.crop.resized_width=$("#profilePicImgCrop").width();H.crop.resized_height=$("#profilePicImgCrop").height();B.formData=H.crop;B.formData.securitytoken=pageData.securitytoken;B.submit();closeUploader()}},done:function(I,H){var F=H.result;if(F){if(F.errors){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get(F.errors[0]),iconType:"error"});return false}else{if(F.imageUrl){$("#profilePhotoUrl").val(F.imageUrl).data("filedataid",F.filedataid);$("#profilePhotoUrl").trigger("focus");$("#btnProfilePhotoContinue").trigger("click");return false}else{$("#defaultAvatars").html(F);$(".defaultAvatarSet").off("click").on("click",function(){$(".defaultAvatarSet").removeClass("defaultAvatarSelected");$(this).addClass("defaultAvatarSelected");$(".profile-img-option-container .default-option").trigger("click")})}}}else{openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"});return false}var G=F.avatarpath.indexOf("?")==-1?"?":"&";var E=F.avatarpath?(F.avatarpath+G+"random="+Math.random()):F[0];var J=$("#profilePicImg").attr("src",pageData.baseurl_core+"/"+E).attr("src");$(".avatar-"+pageData.userid).attr("src",J);$("#profilePicImgCrop").attr("src","");$("#btnProfilePhotoClose").trigger("click")},fail:function(H,F){var G=vBulletin.phrase.get("error_uploading_image");var E="error";if(F&&F.files.length>0){switch(F.files[0].error){case"acceptFileTypes":G=vBulletin.phrase.get("invalid_image_allowed_filetypes_are");E="warning";break}}openAlertDialog({title:vBulletin.phrase.get("upload"),message:G,iconType:E,onAfterClose:function(){A.find(".fileText").val("");A.find(".browse-option").focus()}})},always:function(F,E){A.find(".js-upload-progress").addClass("h-hide");A.find("input,button").prop("disabled",false);A.find(".custom-upload-button").removeClass("h-disabled");return false}});$("#profilePhotoUrl").off("focus").on("focus",function(){$(this).closest(".profile-img-option-container").find(".url-option").trigger("click")})};cropProfilePhoto=function(G){var B=$("#profilePicImgCrop").attr("src");if(B==""){closeUploader();openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("please_select_a_image_to_crop"),iconType:"error"});$("#btnProfilePhotoSave").addClass("h-hide-imp");$("#btnProfilePhotoContinue").removeClass("h-hide-imp");$("div#cropFrame").addClass("h-hide");$("div#uploadFrame").removeClass("h-hide");return false}var F={crop:{}};var A=$("#editProfilePicture");var E=A.data("avatarmaxwidth");var D=A.data("avatarmaxheight");F.crop["x1"]=$("#x1").val()||0;F.crop["x2"]=$("#x2").val()||E;F.crop["y1"]=$("#y1").val()||0;F.crop["y2"]=$("#y2").val()||D;F.crop["width"]=$("#width").val()||E;F.crop["height"]=$("#height").val()||D;F.crop["resized_width"]=$("#profilePicImgCrop").width();F.crop["resized_height"]=$("#profilePicImgCrop").height();F.securitytoken=pageData.securitytoken;var C=$("[name=profile-img-option]:checked").val();if(C=="1"){F.files=$("#profilePhotoFile");F.url=pageData.baseurl+"/profile/upload-profilepicture";$("#profilePhotoFile").fileupload("add",F)}else{if(C=="2"){F.profilePhotoUrl=$("#profilePhotoUrl").val();F.filedataid=$("#profilePhotoUrl").data("filedataid");vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/profile/upload-profilepicture",data:F,success:function(I){var J=I.avatarpath.indexOf("?")==-1?"?":"&";var H=I.avatarpath?(I.avatarpath+J+"random="+Math.random()):I[0];var K=$("#profilePicImg").attr("src",pageData.baseurl_core+"/"+H).attr("src");$(".avatar-"+pageData.userid).attr("src",K);$("#profilePicImgCrop").attr("src","");$("#btnProfilePhotoClose").trigger("click");$("#profilePhotoUrl").data("filedataid","")}})}}resetCropValues()};resetCropValues=function(){$("#x1").val("");$("#x2").val("");$("#y1").val("");$("#y2").val("")};initIAS=function(){var E=false;var B=$("#profilePicImgCrop");var A=$("#editProfilePicture");var D=A.data("avatarmaxwidth");var C=A.data("avatarmaxheight");B.off("load").on("load",function(){if(E){return }if(B.width()>D||B.height()>C){E=true;var F=Math.min(D,C,B.width(),B.height());ias=B.imgAreaSelect({aspectRatio:"1:1",handles:true,zIndex:1012,enable:true,show:true,x1:0,y1:0,x2:F,y2:F,onSelectChange:setDimensions,instance:true})}else{$("#btnProfilePhotoSave").trigger("click")}})};setDefaultAvatar=function(B){var A=$("#editProfilePhotoDlg");A.find(".js-upload-progress").removeClass("h-hide");A.find("button, input").prop("disabled",true);A.find(".custom-upload-button").addClass("h-disabled");$.ajax({url:vBulletin.getAjaxBaseurl()+"/profile/set-default-avatar?avatarid="+B,type:"POST",dataType:"json",success:function(C){if(C){if(C.errors){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get(C.errors[0][0]),iconType:"error"})}else{var D=$("#profilePicImg").attr("src",pageData.baseurl_core+"/"+C.avatarpath).attr("src");$(".avatar-"+pageData.userid).attr("src",D);A.dialog("close");A.find("form").trigger("reset")}}else{openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})},complete:function(){A.find(".js-upload-progress").addClass("h-hide");A.find("input,button").prop("disabled",false);A.find(".custom-upload-button").removeClass("h-disabled")}})};setDimensions=function(A,B){$("#x1").val(B.x1);$("#y1").val(B.y1);$("#x2").val(B.x2);$("#y2").val(B.y2);$("#width").val(B.width);$("#height").val(B.height)};resetAvatar=function(){vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/profile/resetAvatar",success:function(A){var C=$("#profilePicImg").attr("src",pageData.baseurl_core+"/"+A.avatarpath).attr("src");$(".avatar-"+pageData.userid).attr("src",C);$("#btnProfilePhotoClose").trigger("click");var B=$("#editProfilePhotoDlg");B.find("form").trigger("reset")},complete:function(){var A=$("#editProfilePhotoDlg");A.find(".js-upload-progress").addClass("h-hide");A.find("input,button").prop("disabled",false);A.find(".custom-upload-button").removeClass("h-disabled")}})};closeUploader=function(){$("#profilePicImgCrop").imgAreaSelect({remove:true});if(ias!=null){ias=null}$("#profilePhotoFile").fileupload("destroy");$("#profilePhotoFile").removeData(["fileupload","blueimp.fileupload.form"])};